<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Player</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<style>
  *{box-sizing:border-box;}
  body,html{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:sans-serif;}
  .swiper{width:100%;height:100%;max-width:480px;margin:0 auto;background:#000;position:relative;}
  .swiper-slide{width:100%;height:100%;overflow:hidden;position:relative;background:#000;}
  .thumb{position:absolute;top:0;left:0;width:100%;height:100%;z-index:5;transition:opacity 0.3s;overflow:hidden;pointer-events:none;}
  .thumb img{width:100%;height:100%;object-fit:cover;}
  .thumb.hide{opacity:0;}
  .smart-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;background:transparent;cursor:pointer;clip-path:polygon(0% 0%, 100% 0%, 100% 80%, 65% 80%, 65% 100%, 0% 100%);}
  .play-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70px;height:70px;z-index:55;background:rgba(0,0,0,0.6);border-radius:50%;display:flex;justify-content:center;align-items:center;transition:opacity 0.2s;}
  .play-btn::after{content:"";width:0;height:0;border-left:25px solid #fff;border-top:15px solid transparent;border-bottom:15px solid transparent;margin-left:5px;}
  .badge{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.6);color:#fff;padding:5px 15px;border-radius:15px;font-size:14px;z-index:20;}
  .top-header{position:absolute;top:0;left:0;width:100%;padding:15px;color:#fff;text-align:center;z-index:10;font-weight:bold;}
  .mode-btns{position:absolute;bottom:15px;right:15px;display:flex;flex-direction:column;gap:8px;z-index:60;}
  .mode-btn{width:40px;height:40px;background:rgba(0,0,0,0.5);border-radius:8px;display:flex;justify-content:center;align-items:center;cursor:pointer;border:2px solid rgba(255,255,255,0.3);}
  .mode-btn.active{background:rgba(255,255,255,0.2);border-color:#fff;}
  .mode-btn svg{width:20px;height:20px;fill:#fff;}
  .vid-wrap{position:absolute;width:100%;pointer-events:none;}
  .player-box{position:relative;width:100%;height:0;overflow:hidden;}
  .player-box iframe{position:absolute;top:0;left:0;width:100%;height:100%;}
  .fit .vid-wrap{top:50%;transform:translateY(-50%);}
  .fit .player-box{padding-top:56.25%;}
  .square .vid-wrap{top:50%;transform:translateY(-50%);}
  .square .player-box{padding-top:100%;}
  .full .vid-wrap{width:100%;height:100%;top:0;left:0;overflow:hidden;}
  .full .player-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:177.78vh;height:100vh;padding-top:0;}
  @media (min-aspect-ratio: 16/9) {
    .full .player-box{width:100vw;height:56.25vw;}
  }
</style>
</head>
<body>
<div class="swiper"><div class="swiper-wrapper" id="wrap"></div></div>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
var list = [{"id":"Wn7KRv-KmQk","title":"","mode":"full","ranges":[{"s":30,"e":35},{"s":40,"e":45},{"s":50,"e":55}],"topText":"","sub":"","poster":"https://i.ytimg.com/vi/1sGHYtKBS3Y/oar2.jpg?sqp=-oaymwEkCJUDENAFSFqQAgHyq4qpAxMIARUAAAAAJQAAyEI9AICiQ3gB&rs=AOn4CLB4gdSNw1rEw0RXZXXanwQ1BV2VRQ"},{"id":"eLaHc9J9W1g","title":"","mode":"full","ranges":[{"s":30,"e":35},{"s":40,"e":45},{"s":50,"e":55}],"topText":"","sub":"","poster":""},{"id":"-5KXVudFXxM","title":"","mode":"full","ranges":[{"s":30,"e":35},{"s":40,"e":45},{"s":50,"e":55}],"topText":"","sub":"","poster":""}];
var iconFit = '<svg viewBox="0 0 24 24"><rect x="2" y="6" width="20" height="12" rx="1" fill="none" stroke="#fff" stroke-width="2"/></svg>';
var iconSquare = '<svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="1" fill="none" stroke="#fff" stroke-width="2"/></svg>';
var iconFull = '<svg viewBox="0 0 24 24"><path d="M3 3h7v2H5v5H3V3zm11 0h7v7h-2V5h-5V3zM5 14v5h5v2H3v-7h2zm14 0v5h-5v2h7v-7h-2z"/></svg>';
var swiper, players={}, timer=null, userInteracted=false, apiReady=false, activeSegments={}, currentModes={}, isPaused={};
function init(){
  var w=document.getElementById("wrap");
  for(var i=0; i<list.length; i++){
    var v = list[i];
    activeSegments[i]=0; currentModes[i]=v.mode; isPaused[i]=false;
    var d=document.createElement("div"); d.className="swiper-slide " + v.mode; d.id="slide-"+i;
    var imgUrl = v.poster ? v.poster : "https://img.youtube.com/vi/"+v.id+"/hqdefault.jpg";
    var thumb = '<div class="thumb" id="thumb-'+i+'"><img src="'+imgUrl+'" alt=""></div>';
    var playerDiv = '<div class="player-box"><div id="p-'+i+'"></div></div>';
    var controls = '<div class="smart-layer" data-idx="'+i+'"></div><div class="play-btn" id="btn-'+i+'" data-idx="'+i+'"></div>';
    var modeBtns = '<div class="mode-btns">'+
      '<div class="mode-btn'+(v.mode==="fit"?" active":"")+'" data-idx="'+i+'" data-mode="fit">'+iconFit+'</div>'+
      '<div class="mode-btn'+(v.mode==="square"?" active":"")+'" data-idx="'+i+'" data-mode="square">'+iconSquare+'</div>'+
      '<div class="mode-btn'+(v.mode==="full"?" active":"")+'" data-idx="'+i+'" data-mode="full">'+iconFull+'</div></div>';
    d.innerHTML = thumb + '<div class="vid-wrap">' + playerDiv + '</div>' + controls + modeBtns + '<div class="badge">'+v.title+'</div>';
    w.appendChild(d);
  }
  document.addEventListener("click", function(e){
    var b=e.target.closest(".play-btn"), l=e.target.closest(".smart-layer"), m=e.target.closest(".mode-btn");
    if(m) setMode(parseInt(m.dataset.idx), m.dataset.mode);
    else if(b) handlePlayClick(parseInt(b.dataset.idx));
    else if(l) handleLayerClick(parseInt(l.dataset.idx));
  });
  swiper=new Swiper(".swiper",{ direction:"vertical", loop:false, on:{ slideChange:onSlideChange } });
  loadYouTubeAPI();
}
function setMode(i, mode){
  var slide = document.getElementById("slide-"+i);
  slide.className="swiper-slide "+mode; currentModes[i]=mode;
  slide.querySelectorAll(".mode-btn").forEach(function(btn){ btn.classList.toggle("active", btn.dataset.mode===mode); });
}
function loadYouTubeAPI(){
  var tag=document.createElement("script"); tag.src="https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);
}
window.onYouTubeIframeAPIReady=function(){ apiReady=true; createPlayers(); };
function createPlayers(){
  list.forEach(function(v, i){
    players[i]=new YT.Player("p-"+i, {
      videoId:v.id, playerVars:{"controls":0,"modestbranding":1,"playsinline":1,"rel":0,"enablejsapi":1},
      events:{"onStateChange":function(e){ onStateChange(e,i); }}
    });
  });
}
function onStateChange(e,i){
  var b=document.getElementById("btn-"+i), t=document.getElementById("thumb-"+i);
  if(e.data===1){ b.style.opacity="0"; b.style.pointerEvents="none"; t.style.opacity="0"; startMon(i); }
  else if(e.data===2){ b.style.opacity="1"; b.style.pointerEvents="auto"; stopMon(); isPaused[i]=true; }
}
function onSlideChange(){
  stopAll(); var idx=swiper.activeIndex; activeSegments[idx]=0;
  if(userInteracted) setTimeout(function(){ playVideo(idx, true); },300);
}
function handlePlayClick(i){ userInteracted=true; playVideo(i, !isPaused[i]); }
function handleLayerClick(i){ if(!userInteracted){userInteracted=true; playVideo(i, true); return;} toggle(i); }
function toggle(i){ var p=players[i]; if(p.getPlayerState()===1) p.pauseVideo(); else p.playVideo(); }
function playVideo(i, seekToStart){
  var p=players[i]; if(seekToStart) p.seekTo(list[i].ranges[0].s, true);
  p.playVideo();
}
function stopMon(){ if(timer){ clearInterval(timer); timer=null; } }
function stopAll(){
  stopMon(); Object.keys(players).forEach(function(k){ try{players[k].pauseVideo();}catch(e){} });
  document.querySelectorAll(".thumb, .play-btn").forEach(function(el){ el.style.opacity="1"; el.style.pointerEvents="auto"; });
}
function startMon(i){
  stopMon(); timer=setInterval(function(){
    var p=players[i]; if(!p || typeof p.getCurrentTime !== "function") return;
    var currTime=p.getCurrentTime(), seg=activeSegments[i]||0, r=list[i].ranges[seg];
    if(r.e>0 && currTime>=r.e-0.2){
      if(seg<list[i].ranges.length-1){ activeSegments[i]=seg+1; p.seekTo(list[i].ranges[seg+1].s, true); }
      else { stopMon(); if(i<list.length-1) swiper.slideNext(); else swiper.slideTo(0); }
    }
  },100);
}
init();
</script>
</body>
</html>