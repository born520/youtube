<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Player</title>
<script src="https://www.youtube.com/iframe_api"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<style>
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
  body,html{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:sans-serif;}
  .swiper{width:100%;height:100%;max-width:480px;margin:0 auto;background:#000;position:relative;}
  .swiper-slide{width:100%;height:100%;overflow:hidden;position:relative;background:#000;}
  iframe{width:100%;height:100%;border:0;}
  .thumb{position:absolute;top:0;left:0;width:100%;height:100vh;z-index:5;transition:opacity 0.2s;overflow:hidden;}
  .thumb img{width:100%;height:100%;object-fit:cover;}
  .thumb.hide{opacity:0;pointer-events:none;}
  .smart-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;background:transparent;cursor:pointer;clip-path:polygon(0% 0%, 100% 0%, 100% 80%, 65% 80%, 65% 100%, 0% 100%);}
  .play-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70px;height:70px;z-index:55;background:rgba(0,0,0,0.6);border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer;transition:transform 0.1s;}
  .play-btn:active{transform:translate(-50%,-50%) scale(0.95);}
  .play-btn::after{content:"";width:0;height:0;border-left:25px solid #fff;border-top:15px solid transparent;border-bottom:15px solid transparent;margin-left:5px;}
  .play-btn.hide{opacity:0;pointer-events:none;}
  .sub-box{position:absolute;left:50%;transform:translateX(-50%);bottom:10%;max-width:90%;text-align:center;color:#fff;z-index:60;pointer-events:none;text-shadow:1px 1px 2px #000;background:rgba(0,0,0,0.5);padding:8px 16px;border-radius:8px;opacity:0;transition:all 0.1s;}
  .sub-box.show{opacity:1;}
  .badge{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.6);color:#fff;padding:5px 15px;border-radius:15px;font-size:14px;z-index:20;}
  .mode-btns{position:absolute;bottom:15px;right:15px;display:flex;flex-direction:column;gap:8px;z-index:60;}
  .mode-btn{width:40px;height:40px;background:rgba(0,0,0,0.5);border-radius:8px;display:flex;justify-content:center;align-items:center;cursor:pointer;border:2px solid rgba(255,255,255,0.3);transition:all 0.2s;}
  .mode-btn.active{background:rgba(255,255,255,0.2);border-color:#fff;}
  .mode-btn svg{width:20px;height:20px;fill:#fff;}
  .mask-top{position:absolute;top:0;left:0;width:100%;height:60px;z-index:52;}
  .mask-bottom{position:absolute;bottom:0;left:0;width:100%;height:50px;z-index:52;display:flex;}
  .block-area{flex:1;pointer-events:auto;}
  .pass-area{width:130px;pointer-events:none;}
  .top-header{position:absolute;top:0;left:0;width:100%;padding:15px;color:#fff;text-align:center;z-index:10;font-weight:bold;}
  .vid-wrap{position:absolute;left:0;width:100%;overflow:hidden;transition:all 0.3s;}
  .full .vid-wrap{top:0;height:100%;}
  .full .player-wrap{position:absolute;top:0;left:50%;width:177.78vh;height:100%;transform:translateX(-50%);z-index:2;}
  @media(max-aspect-ratio:9/16){.full .player-wrap{width:320%;left:-110%;transform:none;}}
  .fit .vid-wrap{top:50%;padding-top:56.25%;transform:translateY(-50%);}
  .fit .player-wrap{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;}
  .square .vid-wrap{top:50%;padding-top:100%;transform:translateY(-50%);}
  .square .player-wrap{position:absolute;top:0;left:50%;width:177.78%;height:100%;transform:translateX(-50%);z-index:2;}
</style>
</head>
<body>
<div class="swiper"><div class="swiper-wrapper" id="wrap"></div></div>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
var list = [{"id":"Wn7KRv-KmQk","title":"","mode":"full","ranges":[{"s":240260280,"e":250265285}],"topText":"","sub":"","poster":"https://i.ytimg.com/vi/1sGHYtKBS3Y/oar2.jpg?sqp=-oaymwEkCJUDENAFSFqQAgHyq4qpAxMIARUAAAAAJQAAyEI9AICiQ3gB&rs=AOn4CLB4gdSNw1rEw0RXZXXanwQ1BV2VRQ"}];
var iconFit = '<svg viewBox="0 0 24 24"><rect x="2" y="6" width="20" height="12" rx="1" fill="none" stroke="#fff" stroke-width="2"/></svg>';
var iconSquare = '<svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="1" fill="none" stroke="#fff" stroke-width="2"/></svg>';
var iconFull = '<svg viewBox="0 0 24 24"><path d="M3 3h7v2H5v5H3V3zm11 0h7v7h-2V5h-5V3zM5 14v5h5v2H3v-7h2zm14 0v5h-5v2h7v-7h-2z"/></svg>';
var swiper, players={}, timer=null, userInteracted=false;
var activeSegments={}, currentModes={}, isPaused={}, lastTimes={}, playerReady={};
var loadQueue=[], isLoading=false, firstReady=false;
window.onYouTubeIframeAPIReady=function(){
  createFirstPlayer();
};
function createFirstPlayer(){
  if(list.length === 0) return;
  var startSec = Math.floor(list[0].ranges[0].s);
  players[0] = new YT.Player("p-0", {
    videoId: list[0].id,
    playerVars: {
      controls:0, modestbranding:1, playsinline:1, rel:0, enablejsapi:1,
      start: startSec
    },
    events: {
      onReady: function(e){ onFirstPlayerReady(e); },
      onStateChange: function(e){ onStateChange(e, 0); }
    }
  });
}
function onFirstPlayerReady(e){
  playerReady[0] = true;
  firstReady = true;
  for(var i=1; i<list.length; i++) loadQueue.push(i);
  setTimeout(loadNextPlayer, 3000);
}
function loadNextPlayer(){
  if(loadQueue.length === 0 || isLoading) return;
  isLoading = true;
  var idx = loadQueue.shift();
  var startSec = Math.floor(list[idx].ranges[0].s);
  players[idx] = new YT.Player("p-"+idx, {
    videoId: list[idx].id,
    playerVars: {
      controls:0, modestbranding:1, playsinline:1, rel:0, enablejsapi:1,
      start: startSec
    },
    events: {
      onReady: function(e){ onPlayerReady(e, idx); },
      onStateChange: function(e){ onStateChange(e, idx); }
    }
  });
}
function onPlayerReady(e, idx){
  playerReady[idx] = true;
  isLoading = false;
  setTimeout(loadNextPlayer, 2000);
}
function createModeBtns(i, mode){
  var h = '<div class="mode-btns">';
  h += '<div class="mode-btn'+(mode==="fit"?" active":"")+'" data-idx="'+i+'" data-mode="fit">'+iconFit+'</div>';
  h += '<div class="mode-btn'+(mode==="square"?" active":"")+'" data-idx="'+i+'" data-mode="square">'+iconSquare+'</div>';
  h += '<div class="mode-btn'+(mode==="full"?" active":"")+'" data-idx="'+i+'" data-mode="full">'+iconFull+'</div>';
  h += '</div>'; return h;
}
function init(){
  var w=document.getElementById("wrap");
  for(var i=0; i<list.length; i++){
    var v = list[i];
    activeSegments[i]=0; currentModes[i]=v.mode; isPaused[i]=false; lastTimes[i]=0; playerReady[i]=false;
    var d=document.createElement("div");
    d.className="swiper-slide " + v.mode; d.id="slide-"+i;
    var imgUrl = v.poster ? v.poster : "https://img.youtube.com/vi/"+v.id+"/hqdefault.jpg";
    var thumb = '<div class="thumb" id="thumb-'+i+'"><img src="'+imgUrl+'"></div>';
    var playerDiv = '<div class="player-wrap"><div id="p-'+i+'"></div></div>';
    var masks = '<div class="mask-top"></div><div class="mask-bottom"><div class="block-area"></div><div class="pass-area"></div></div>';
    var controls = '<div class="smart-layer" data-idx="'+i+'"></div><div class="play-btn" id="btn-'+i+'" data-idx="'+i+'"></div><div class="sub-box" id="sub-'+i+'"></div>';
    var modeBtns = createModeBtns(i, v.mode);
    var header = v.topText ? '<div class="top-header">'+v.topText+'</div>' : '';
    d.innerHTML = thumb + header + '<div class="vid-wrap">' + playerDiv + masks + '</div>' + controls + modeBtns + '<div class="badge">'+v.title+'</div>';
    w.appendChild(d);
  }
  document.addEventListener("click", handleInteract);
  document.addEventListener("touchend", handleInteract);
  swiper=new Swiper(".swiper",{ direction:"vertical", on:{ slideChangeTransitionStart:onSlideChangeStart, slideChangeTransitionEnd:onSlideChangeEnd } });
}
function handleInteract(e){
  var b=e.target.closest(".play-btn"), l=e.target.closest(".smart-layer"), m=e.target.closest(".mode-btn");
  if(m){ 
    e.preventDefault(); 
    setMode(parseInt(m.dataset.idx), m.dataset.mode); return; 
  }
  if(b){ 
    e.preventDefault();
    userInteracted=true; 
    b.classList.add("hide"); 
    var t = document.getElementById("thumb-"+b.dataset.idx); if(t) t.classList.add("hide");
    playVideo(parseInt(b.dataset.idx), true); 
  }
  else if(l){ 
    if(!userInteracted){ 
       e.preventDefault();
       userInteracted=true; 
       var bBtn = document.getElementById("btn-"+l.dataset.idx);
       if(bBtn) bBtn.classList.add("hide");
       var t = document.getElementById("thumb-"+l.dataset.idx); if(t) t.classList.add("hide");
       playVideo(parseInt(l.dataset.idx), true); 
    } else { 
       toggle(parseInt(l.dataset.idx)); 
    }
  }
}
function setMode(i, mode){
  var slide = document.getElementById("slide-"+i);
  slide.classList.remove("full", "fit", "square"); slide.classList.add(mode); currentModes[i] = mode;
  var btns = slide.querySelectorAll(".mode-btn");
  for(var j=0; j<btns.length; j++){
    if(btns[j].dataset.mode === mode) btns[j].classList.add("active");
    else btns[j].classList.remove("active");
  }
}
function onStateChange(e,i){
  var b=document.getElementById("btn-"+i), t=document.getElementById("thumb-"+i);
  if(e.data===1){ b.classList.add("hide"); t.classList.add("hide"); isPaused[i]=false; startMon(i); }
  else if(e.data===2){ b.classList.remove("hide"); stopMon(); isPaused[i]=true; }
  else if(e.data===0){ b.classList.remove("hide"); }
}
function onSlideChangeStart(){
  for(var k in players){ try{ if(players[k] && players[k].getPlayerState()===1) lastTimes[k]=players[k].getCurrentTime(); if(players[k]) players[k].pauseVideo(); }catch(e){} }
  stopMon();
}
function onSlideChangeEnd(){
  var idx=swiper.activeIndex;
  if(userInteracted && playerReady[idx]) setTimeout(function(){ playVideo(idx, lastTimes[idx]===0); }, 300);
}
function toggle(i){ if(!playerReady[i]) return; var p=players[i]; if(p.getPlayerState()===1){ lastTimes[i]=p.getCurrentTime(); p.pauseVideo(); } else { p.playVideo(); } }
function playVideo(i, seekToStart){
  if(!playerReady[i]) return;
  var p=players[i];
  var seg=activeSegments[i]||0;
  var startTime = list[i].ranges[seg].s;
  if(seekToStart || lastTimes[i] === 0) {
    var current = p.getCurrentTime();
    if(Math.abs(current - startTime) > 1) {
       p.seekTo(startTime, true);
    }
  } else {
    p.seekTo(lastTimes[i], true);
  }
  p.playVideo();
}
function startMon(i){
  stopMon();
  timer=setInterval(function(){
  var p=players[i]; if(!p || typeof p.getCurrentTime !== "function") return;
  var curr=p.getCurrentTime();
  var dur=p.getDuration();
  var seg=activeSegments[i]||0;
  var r=list[i].ranges[seg];
  var endTime = (r.e > 0) ? r.e : dur;
  if(endTime > 0 && curr >= endTime - 0.3){
    if(seg < list[i].ranges.length-1){ activeSegments[i]=seg+1; lastTimes[i]=0; p.seekTo(list[i].ranges[seg+1].s, true); }
    else { goNext(); }
  }
  },100);
}
function stopMon(){ if(timer){clearInterval(timer); timer=null;} }
function goNext(){
  stopMon(); var curr=swiper.activeIndex; lastTimes[curr]=0;
  if(curr < list.length-1){ swiper.slideNext(); }
  else {
    for(var i=0;i<list.length;i++){ activeSegments[i]=0; lastTimes[i]=0; }
    swiper.slideTo(0, 300);
    setTimeout(function(){
      var ths = document.querySelectorAll(".thumb"); for(var x=0; x<ths.length; x++) ths[x].classList.remove("hide");
      var bts = document.querySelectorAll(".play-btn"); for(var y=0; y<bts.length; y++) bts[y].classList.remove("hide");
      if(userInteracted) playVideo(0, true);
    }, 400);
  }
}
init();
</script>
</body>
</html>