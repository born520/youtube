<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Player</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<style>
  body,html{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:sans-serif;}
  .swiper{width:100%;height:100%;max-width:480px;margin:0 auto;background:#000;position:relative;}
  .swiper-slide{display:flex;flex-direction:column;justify-content:center;align-items:center;overflow:hidden;position:relative;background:#000;}
  iframe{width:100%;height:100%;border:0;}
  .thumb{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;z-index:5;transition:opacity 0.3s;}
  .thumb.hide{opacity:0;pointer-events:none;}
  .smart-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;background:transparent;cursor:pointer;clip-path:polygon(0% 0%, 100% 0%, 100% 80%, 65% 80%, 65% 100%, 0% 100%);}
  .play-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:70px;height:70px;z-index:55;background:rgba(0,0,0,0.6);border-radius:50%;display:flex;justify-content:center;align-items:center;}
  .play-btn::after{content:'';width:0;height:0;border-left:25px solid #fff;border-top:15px solid transparent;border-bottom:15px solid transparent;margin-left:5px;}
  .play-btn.hide{opacity:0;pointer-events:none;}
  .sub-box{position:absolute;left:50%;transform:translateX(-50%);bottom:10%;max-width:90%;text-align:center;color:#fff;z-index:60;pointer-events:none;text-shadow:1px 1px 2px #000;background:rgba(0,0,0,0.5);padding:8px 16px;border-radius:8px;opacity:0;transition:all 0.1s;}
  .sub-box.show{opacity:1;}
  .full .player-wrap{position:absolute;top:0;left:50%;width:177.78vh;height:100%;transform:translateX(-50%);z-index:2;}
  @media(max-aspect-ratio:9/16){.full .player-wrap{width:320%;height:100%;left:-110%;transform:none;}}
  .top-header{width:100%;padding:15px;color:#fff;text-align:center;z-index:10;font-weight:bold;min-height:50px;}
  .vid-wrap{position:relative;width:100%;background:#000;overflow:hidden;}
  .fit .vid-wrap{flex:1;}
  .square .vid-wrap{padding-top:100%;}
  .fit .thumb, .square .thumb{position:absolute;top:0;left:0;width:100%;height:100%;}
  .player-wrap{position:absolute;top:0;left:50%;transform:translateX(-50%);width:177.78%;height:100%;z-index:2;}
  .mask-top{position:absolute;top:0;left:0;width:100%;height:60px;z-index:52;}
  .mask-bottom{position:absolute;bottom:0;left:0;width:100%;height:50px;z-index:52;display:flex;}
  .block-area{flex:1;pointer-events:auto;}
  .pass-area{width:130px;pointer-events:none;}
  .badge{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.6);color:#fff;padding:5px 15px;border-radius:15px;font-size:14px;z-index:20;}
</style>
</head>
<body>
<div class="swiper"><div class="swiper-wrapper" id="wrap"></div></div>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
const list = [{"id":"yx_cR1cWZn0","title":"","mode":"square","ranges":[{"s":10,"e":20},{"s":60,"e":70},{"s":80,"e":90},{"s":110,"e":120},{"s":140,"e":150}],"topText":"한옥문의 양산이야기\n서창동을 돌아봅니다.","sub":"","poster":"https://i.ytimg.com/vi/1sGHYtKBS3Y/oar2.jpg?sqp=-oaymwEkCJUDENAFSFqQAgHyq4qpAxMIARUAAAAAJQAAyEI9AICiQ3gB&rs=AOn4CLB4gdSNw1rEw0RXZXXanwQ1BV2VRQ"}];
let swiper, players={}, subs={}, timer=null, userInteracted=false, apiReady=false, activeSegments={};
function getThumbUrl(vid){ return "https://img.youtube.com/vi/"+vid+"/hqdefault.jpg"; }
function init(){
  const w=document.getElementById("wrap");
  list.forEach((v,i)=>{
    activeSegments[i]=0;
    const d=document.createElement("div");
    d.className="swiper-slide " + v.mode;
    subs[i]=parseSrt(v.sub);
    const imgUrl = v.poster ? v.poster : getThumbUrl(v.id);
    const thumb = '<div class="thumb" id="thumb-'+i+'" style="background-image:url(\''+imgUrl+'\')"></div>';
    const playerDiv = '<div class="player-wrap"><div id="p-'+i+'"></div></div>';
    const controls = '<div class="mask-top"></div><div class="mask-bottom"><div class="block-area"></div><div class="pass-area"></div></div><div class="smart-layer" data-idx="'+i+'"></div><div class="play-btn" id="btn-'+i+'" data-idx="'+i+'"></div><div class="sub-box" id="sub-'+i+'"></div>';
    if(v.mode==="fit"||v.mode==="square"){
      d.innerHTML=(v.topText?'<div class="top-header">'+v.topText+'</div>':'')+'<div class="vid-wrap">'+thumb+playerDiv+controls+'</div>';
    }else{
      d.innerHTML=thumb+playerDiv+controls+'<div class="badge">'+v.title+'</div>';
    }
    w.appendChild(d);
  });
  document.addEventListener("click", e => {
    const b=e.target.closest(".play-btn"), l=e.target.closest(".smart-layer");
    if(b) handlePlayClick(parseInt(b.dataset.idx));
    else if(l) handleLayerClick(parseInt(l.dataset.idx));
  });
  swiper=new Swiper(".swiper",{ direction:"vertical", on:{ slideChange:()=>handleSlideChange() } });
  loadYouTubeAPI();
}
function loadYouTubeAPI(){
  var tag=document.createElement("script"); tag.src="https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);
}
window.onYouTubeIframeAPIReady=()=>{ apiReady=true; createPlayers(); };
function createPlayers(){
  list.forEach((v,i)=>{
    players[i]=new YT.Player("p-"+i, {
      videoId:v.id, playerVars:{"controls":0,"modestbranding":1,"playsinline":1,"rel":0,"enablejsapi":1},
      events:{"onStateChange":e=>onStateChange(e,i)}
    });
  });
}
function onStateChange(e,i){
  const b=document.getElementById("btn-"+i), t=document.getElementById("thumb-"+i);
  if(e.data===1){ b.classList.add("hide"); t.classList.add("hide"); startMon(i); }
  else if(e.data===2||e.data===0){ b.classList.remove("hide"); if(e.data===0 && userInteracted) next(); }
}
function handleSlideChange(){ stopAll(); if(userInteracted) setTimeout(()=>play(swiper.activeIndex),300); }
function handlePlayClick(i){ userInteracted=true; play(i); }
function handleLayerClick(i){ if(!userInteracted){userInteracted=true; play(i); return;} toggle(i); }
function toggle(i){ const p=players[i]; (p.getPlayerState()===1)?p.pauseVideo():p.playVideo(); }
function play(i){
  const p=players[i], s=list[i].ranges[activeSegments[i]||0].s;
  p.seekTo(s,true); p.playVideo();
}
function stopAll(){
  if(timer) clearInterval(timer);
  Object.values(players).forEach(p=>{ try{p.pauseVideo();}catch(e){} });
  document.querySelectorAll(".thumb").forEach(t=>t.classList.remove("hide"));
}
function next(){ (swiper.activeIndex<list.length-1)?swiper.slideNext():swiper.slideTo(0); }
function startMon(i){
  if(timer) clearInterval(timer);
  timer=setInterval(()=>{
    const p=players[i], t=p.getCurrentTime(), r=list[i].ranges[activeSegments[i]||0];
    if(r.e>0 && t>=r.e-0.3){
      if(activeSegments[i]<list[i].ranges.length-1){ activeSegments[i]++; play(i); }
      else { next(); }
    }
  },100);
}
function parseSrt(t){ if(!t||!t.includes("-->")) return t?[{s:0,e:9999,t:t}]:[]; return []; }
init();
</script>
</body>
</html>